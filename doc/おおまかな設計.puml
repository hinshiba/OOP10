@startuml 大まかな設計

!define INTERFACE_COLOR #C8E6C9

skinparam linetype ortho

' ============================================
' ドメインモデル（値オブジェクト）
' ============================================
package "Domain" {
    class SourceLocation {
        + FilePath: string
        + Line: int
    }

    class Breakpoint {
        + Id: int
        + Location: SourceLocation
        + IsEnabled: bool
    }

    enum ExecutionState {
        Stopped
        Running
        Paused
        Terminated
    }

    class RegisterSnapshot {
        + Registers: int[32]
        + PC: int
        + HI: int
        + LO: int
    }

    class MemoryRange {
        + Address: int
        + Data: byte[]
    }

    class DebugEvent {
        + Type: DebugEventType
        + Location: SourceLocation
        + Message: string
    }

    enum DebugEventType {
        BreakpointHit
        StepCompleted
        ProgramTerminated
        Error
    }
}

' ============================================
' ブートストラップ
' ============================================
package "Boot Strap" {
    class Program {
        + Main()
    }
}
' ============================================
' アプリケーション
' ============================================

package "Application" {

    class Application {
    }

    interface IApplication INTERFACE_COLOR {
        + LoadSource(path: string): bool
        + SetBreakpoint(location: SourceLocation): Breakpoint
        + RemoveBreakpoint(id: int): void
        --
        + Run(): void
        + Pause(): void
        + StepOver(): void
        + StepInto(): void
        + Stop(): void
        --
        + GetState(): ExecutionState
        + GetRegisters(): RegisterSnapshot
        + ReadMemory(addr: int, size: int): MemoryRange
        + OnDebugEvent: Action<DebugEvent>
    }

    interface IDebugger INTERFACE_COLOR {
        + Load(source: string): bool
        + Run(): void
        + Pause(): void
        + Step(): void
        + Stop(): void
        --
        + SetBreakpoint(addr: int): int
        + RemoveBreakpoint(id: int): void
        --
        + GetPC(): int
        + GetRegisters(): int[]
        + ReadMemory(addr: int, size: int): byte[]
        + OnEvent: Action<DebugEvent>
    }


    IApplication <|.. Application
    Application --> IDebugger

}


' ============================================
' エディタ側
' ============================================

package "EditorController" {

    class DebugAdapter {
    }

    class BuiltInGUI {
    }

}

DebugAdapter --> IApplication
BuiltInGUI --> IApplication



' ============================================
' ゲートウェイ
' ============================================

package "Gateways" {

    class SpimGateway {
    }

}

IDebugger <|.. SpimGateway

' ============================================
' デバッガ
' ============================================

package "Debugger" {
    ' 独自のデバッガ, TODO
    class PlusPimDebugger {
    }

}

IDebugger <|.. PlusPimDebugger



' ============================================
' 外の依存関係
' ============================================



@enduml
