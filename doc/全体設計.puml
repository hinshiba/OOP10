@startuml MIPS Debugger Architecture Overview

!define COMPILER_COLOR #E1F5FE
!define RUNTIME_COLOR #FFF3E0
!define PRESENTATION_COLOR #F3E5F5
!define INTERFACE_COLOR #C8E6C9

skinparam packageStyle rectangle
skinparam linetype ortho

package "Presentation Layer (GUI)" PRESENTATION_COLOR {
    package "ViewModels" {
        class MainViewModel
        class EditorViewModel
        class RegisterViewModel
        class MemoryViewModel
        class DebugControlViewModel
        class TimeTravelViewModel
    }
    
    package "Views (Avalonia)" {
        class MainWindow
        class EditorView
        class RegisterView
        class MemoryView
    }
    
    interface ICompilerService INTERFACE_COLOR
    interface IDebuggerService INTERFACE_COLOR
    interface IRuntimeService INTERFACE_COLOR
}

package "Runtime Layer (Execution/Debug)" RUNTIME_COLOR {
    package "Core Interfaces" INTERFACE_COLOR {
        interface IProcessor
        interface IMemory
        interface IRegisterFile
        interface IDebugger
        interface ITimeTravel
    }
    
    package "Implementations" {
        class MipsProcessor
        class Memory
        class RegisterFile
        class Debugger
        class TimeTravelEngine
        class BreakpointManager
    }
    
    package "Services" {
        class DebuggerService
        class RuntimeService
    }
}

package "Compiler Layer (Extended Syntax)" COMPILER_COLOR {
    package "Core Interfaces" INTERFACE_COLOR {
        interface ILexer
        interface IParser
        interface IRegisterAllocator
        interface ICodeGenerator
        interface IAssembler
    }
    
    package "Implementations" {
        class ExtendedLexer
        class ExtendedParser
        class RegisterAllocator
        class MipsCodeGenerator
        class Assembler
    }
    
    package "Services" {
        class CompilerService
    }
    
    package "Domain Models" {
        class AST
        class InterferenceGraph
        class VirtualRegister
        class PhysicalRegister
    }
}

' 依存関係 (依存性逆転: 上位レイヤーは下位レイヤーのインターフェースに依存)
MainViewModel ..> ICompilerService : uses
MainViewModel ..> IDebuggerService : uses
MainViewModel ..> IRuntimeService : uses
DebugControlViewModel ..> IDebuggerService : uses
TimeTravelViewModel ..> IDebuggerService : uses

ICompilerService <|.. CompilerService : implements
IDebuggerService <|.. DebuggerService : implements
IRuntimeService <|.. RuntimeService : implements

CompilerService ..> ILexer : uses
CompilerService ..> IParser : uses
CompilerService ..> IRegisterAllocator : uses
CompilerService ..> ICodeGenerator : uses
CompilerService ..> IAssembler : uses

DebuggerService ..> IDebugger : uses
DebuggerService ..> ITimeTravel : uses
RuntimeService ..> IProcessor : uses
RuntimeService ..> IMemory : uses

IProcessor <|.. MipsProcessor : implements
IMemory <|.. Memory : implements
IRegisterFile <|.. RegisterFile : implements
IDebugger <|.. Debugger : implements
ITimeTravel <|.. TimeTravelEngine : implements

ILexer <|.. ExtendedLexer : implements
IParser <|.. ExtendedParser : implements
IRegisterAllocator <|.. RegisterAllocator : implements
ICodeGenerator <|.. MipsCodeGenerator : implements
IAssembler <|.. Assembler : implements

note right of ICompilerService
  依存性逆転の原則:
  Presentation層は具象クラスではなく
  インターフェースに依存
end note

note right of CompilerService
  オープン・クローズドの原則:
  拡張に開放、修正に閉鎖
  異なる構文も対応可能
end note

note bottom of MipsProcessor
  単一責任の原則:
  各クラスは1つの責務のみ
end note

@enduml
